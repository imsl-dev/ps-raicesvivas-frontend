<div class="signup-page">
    <div class="background-animation">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    @if (!loading && user) {
    <div class="signup-container">
        <div class="signup-header">


            <div class="logo-container">
                <img [src]="user.rutaImg" alt="Profile Logo" class="logo-img" />
            </div>
            <div class="d-flex justify-content-center gap-2">
                <h2 class="signup-title mb-0">{{ user.nombre }} {{ user.apellido }}</h2>

                @if(isMyProfile && !isEditMode) {
                <button class="btn btn-light p-1 inverted-emoji" title="Editar perfil" (click)="editProfile()">
                    ‚úèÔ∏è
                </button>
                }
            </div>

        </div>

        <!-- VIEW MODE -->
        @if(!isEditMode) {
        <div class="signup-form">

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Nombre</label>
                    <input type="text" class="form-control" [value]="user.nombre" readonly />
                </div>
                <div class="form-group">
                    <label class="form-label">Apellido</label>
                    <input type="text" class="form-control" [value]="user.apellido" readonly />
                </div>
            </div>
            <div class="form-row">


                <div class="form-group">
                    <label class="form-label">Rol</label>
                    <input type="text" class="form-control" [value]="rolFormateado" readonly />
                </div>

                <div class="form-group">
                    <label class="form-label">Provincia</label>
                    <input type="text" class="form-control" [value]="user.provincia?.nombre || '-'" readonly />
                </div>
            </div>


            <div class="form-row">
                <div class="form-group d-flex justify-content-center">
                    <label class="form-label">Contacto</label>
                    <input type="text" class="form-control" [value]="user.email || '-'" readonly />
                </div>

                @if(isMyProfile && !tienePeticionActiva && !esAdministrador) {
                <div class="form-group d-flex justify-content-center">
                    <label class="form-label">¬øTe interesa organizar eventos?</label>
                    <button class="btn btn-warning" title="Solicitar ser un organizador de eventos"
                        (click)="openDialog()">
                        üöÄ Saber m√°s
                    </button>
                </div>
                }
                @else if (isMyProfile && tienePeticionActiva && !tienePeticionAceptada && !tienePeticionCancelada) {
                <div class="form-group d-flex justify-content-center">
                    <label class="form-label">¬øTe interesa organizar eventos?</label>
                    <button class="btn btn-info" title="">
                        Tu petici√≥n est√° siendo validada
                    </button>
                </div>
                }
                @else if (isMyProfile && tienePeticionActiva && tienePeticionAceptada) {
                <div class="form-group d-flex justify-content-center">
                    <label class="form-label">¬øTe interesa organizar eventos?</label>
                    <button class="btn btn-success" title="">
                        ¬°Ya sos organizador!
                    </button>
                </div>
                }
                @else if (isMyProfile && tienePeticionActiva && tienePeticionCancelada) {
                <div class="form-group d-flex justify-content-center">
                    <label class="form-label">¬øTe interesa organizar eventos?</label>
                    <button class="btn btn-danger" title="">
                        Tu petici√≥n fue rechazada
                    </button>
                </div>
                }

            </div>
        </div>
        }

        <!-- EDIT MODE -->
        @if(isEditMode) {
        <form class="signup-form" (ngSubmit)="saveProfile()">

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">üë§</span>
                        Nombre
                        <span class="required">*</span>
                    </label>
                    <input type="text" class="form-control" [(ngModel)]="editForm.nombre" name="nombre"
                        [class.is-invalid]="formErrors.nombre" [class.is-valid]="!formErrors.nombre && editForm.nombre"
                        placeholder="Ingrese su nombre" [disabled]="isSaving" />
                    @if(formErrors.nombre) {
                    <div class="error-message">
                        <span class="error-icon">‚ö†Ô∏è</span>
                        {{ formErrors.nombre }}
                    </div>
                    }
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">üë§</span>
                        Apellido
                        <span class="required">*</span>
                    </label>
                    <input type="text" class="form-control" [(ngModel)]="editForm.apellido" name="apellido"
                        [class.is-invalid]="formErrors.apellido"
                        [class.is-valid]="!formErrors.apellido && editForm.apellido" placeholder="Ingrese su apellido"
                        [disabled]="isSaving" />
                    @if(formErrors.apellido) {
                    <div class="error-message">
                        <span class="error-icon">‚ö†Ô∏è</span>
                        {{ formErrors.apellido }}
                    </div>
                    }
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">üìß</span>
                        Contacto (Email)
                        <span class="required">*</span>
                    </label>
                    <input type="email" class="form-control" [(ngModel)]="editForm.email" name="email"
                        [class.is-invalid]="formErrors.email" [class.is-valid]="!formErrors.email && editForm.email"
                        placeholder="correo@ejemplo.com" [disabled]="isSaving" />
                    @if(formErrors.email) {
                    <div class="error-message">
                        <span class="error-icon">‚ö†Ô∏è</span>
                        {{ formErrors.email }}
                    </div>
                    }
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="label-icon">üìç</span>
                        Provincia
                        <span class="required">*</span>
                    </label>
                    <select class="form-control" [(ngModel)]="editForm.idProvincia" name="provincia"
                        [class.is-invalid]="formErrors.idProvincia"
                        [class.is-valid]="!formErrors.idProvincia && editForm.idProvincia" [disabled]="isSaving">
                        <option value="0" disabled>Seleccione una provincia</option>
                        @for(provincia of provincias; track provincia.id) {
                        <option [value]="provincia.id">{{ provincia.nombre }}</option>
                        }
                    </select>
                    @if(formErrors.idProvincia) {
                    <div class="error-message">
                        <span class="error-icon">‚ö†Ô∏è</span>
                        {{ formErrors.idProvincia }}
                    </div>
                    }
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-row">
                <button type="button" class="btn-cancel" (click)="cancelEdit()" [disabled]="isSaving">
                    <span class="btn-icon">‚ùå</span>
                    Cancelar
                </button>

                <button type="submit" class="btn-submit" [disabled]="isSaving">
                    <span class="btn-icon">üíæ</span>
                    {{ isSaving ? 'Guardando...' : 'Guardar Cambios' }}
                </button>
            </div>

            @if(error) {
            <div class="error-message" style="margin-top: 1rem; justify-content: center;">
                <span class="error-icon">‚ö†Ô∏è</span>
                {{ error }}
            </div>
            }
        </form>
        }

    </div>
    } @else {
    <div class="signup-container">
        @if (loading) {
        <h2 class="signup-title">Cargando...</h2>
        } @else {
        <p class="error-message">{{ error }}</p>
        }
    </div>
    }
</div>