<nav class="navbar navbar-expand-lg fixed-top">
    <div class="container-fluid px-4">
        <!-- Logo y Brand -->
        <a class="navbar-brand d-flex align-items-center" routerLink="/">
            <img src="/raices_vivas_logo.png" alt="Ra√≠ces Vivas Logo" class="navbar-logo">
            <span class="brand-text">Ra√≠ces Vivas</span>
        </a>

        <!-- Toggle button para m√≥vil -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Men√∫ de navegaci√≥n -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-lg-center">
                <!-- Links de navegaci√≥n -->
                <li class="nav-item">
                    <a class="nav-link" routerLink="/home" routerLinkActive="active">
                        <span class="nav-icon">üè†</span>
                        <span class="nav-text">Inicio</span>
                    </a>
                </li>

                <!-- Nuestro Impacto - Solo para usuarios con rol USUARIO -->
                @if (esUsuario()) {
                <li class="nav-item">
                    <a class="nav-link" (click)="scrollToSection('impacto')">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-text">Nuestro Impacto</span>
                    </a>
                </li>
                }

                <li class="nav-item">
                    <a class="nav-link" routerLink="/eventos" routerLinkActive="active">
                        <span class="nav-icon">üìÖ</span>
                        <span class="nav-text">Eventos</span>
                    </a>
                </li>

                <!-- Testimonios - Solo para usuarios con rol USUARIO -->
                @if (esUsuario()) {
                    <li class="nav-item">
                        <a class="nav-link" routerLink="/donaciones" routerLinkActive="active">
                            <span class="nav-icon">üí¨</span>
                            <span class="nav-text">Mural de Donaciones</span>
                        </a>
                    </li>
                }

                <!-- Panel Organizador - Solo para organizadores -->
                @if (esOrganizador()) {
                <li class="nav-item">
                    <a class="nav-link" routerLink="/panel-organizadores" routerLinkActive="active">
                        <span class="nav-icon">üë®‚Äçüíº</span>
                        <span class="nav-text">Panel Organizador</span>
                    </a>
                </li>
                }

                <!-- Panel Administrador - Solo para admins -->
                @if (esAdmin()) {
                <li class="nav-item">
                    <a class="nav-link" routerLink="/panel-administradores" routerLinkActive="active">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span class="nav-text">Panel Administrador</span>
                    </a>
                </li>
                }

                <!-- Divisor visible solo en desktop -->
                @if (authService.isAuthenticated$ | async) {
                <li class="nav-divider d-none d-lg-block"></li>
                }

                <!-- Secci√≥n de usuario autenticado -->
                @if (authService.isAuthenticated$ | async) {
                <!-- Puntos del usuario - Solo para rol USUARIO -->
                @if (mostrarSeccionPuntos) {
                <li class="nav-item puntos-container">
                    <div class="puntos-badge">
                        <span class="puntos-icon">‚≠ê</span>
                        <div class="puntos-info">
                            <span class="puntos-label">Mis puntos</span>
                            <span class="puntos-valor">{{ usuarioLogeado?.puntos }}</span>
                        </div>
                    </div>
                    <button class="btn btn-canjear" (click)="canjearPuntos()">
                        <span class="btn-icon">üéÅ</span>
                        <span>Canjear</span>
                    </button>
                </li>
                }

                <!-- Dropdown de perfil de usuario -->
                <li class="nav-item dropdown-perfil" (clickOutside)="cerrarDropdown()">
                    <button class="btn-perfil" (click)="toggleDropdownPerfil()">
                        <img [src]="getImagenPerfil()" [alt]="usuarioLogeado?.nombre" class="avatar-img">
                    </button>

                    <!-- Men√∫ dropdown -->
                    @if (mostrarDropdownPerfil) {
                    <div class="dropdown-menu-perfil">
                        <!-- Informaci√≥n del usuario -->
                        <div class="dropdown-header">
                            <img [src]="getImagenPerfil()" [alt]="usuarioLogeado?.nombre" class="avatar-img-large">
                            <div class="user-info">
                                <span class="user-name">{{ usuarioLogeado?.nombre }} {{ usuarioLogeado?.apellido
                                    }}</span>
                                <span class="user-email">{{ usuarioLogeado?.email }}</span>
                            </div>
                        </div>

                        <div class="dropdown-divider"></div>

                        <!-- Opciones del men√∫ -->
                        <button class="dropdown-item" (click)="editarPerfil()">
                            <span class="item-icon">üë§</span>
                            <span>Mi perfil</span>
                        </button>

                        <div class="dropdown-divider"></div>

                        <button class="dropdown-item logout-item" (click)="logout()">
                            <span class="item-icon">üö™</span>
                            <span>Cerrar sesi√≥n</span>
                        </button>
                    </div>
                    }
                </li>
                }
                @else {
                <!-- Botones para usuarios no autenticados -->
                <li class="nav-item">
                    <button class="btn btn-login" routerLink="/login">
                        <span class="btn-icon">üîë</span>
                        <span>Iniciar sesi√≥n</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="btn btn-signup" routerLink="/signup">
                        <span class="btn-icon">üå±</span>
                        <span>Unirse</span>
                    </button>
                </li>
                }
            </ul>
        </div>
    </div>
</nav>