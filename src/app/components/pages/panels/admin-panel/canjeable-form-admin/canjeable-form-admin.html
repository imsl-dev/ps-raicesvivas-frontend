<div class="content-wrapper">
    <div class="header">
        <h2>{{ tituloFormulario }}</h2>
        <button class="btn btn-secondary" (click)="volver()">
            ← Volver al Listado
        </button>
    </div>

    <div class="content-body">
        @if (loading) {
        <div class="loading">
            <div class="spinner-border text-success mb-3" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p>Cargando datos del canjeable...</p>
        </div>
        } @else {
        <form [formGroup]="canjeableForm" (ngSubmit)="onSubmit()" class="canjeable-form">
            <!-- Nombre del canjeable -->
            <div class="form-group">
                <label for="nombre">
                    Nombre del Canjeable <span class="required-asterisk">*</span>
                </label>
                <input type="text" id="nombre" class="form-control" formControlName="nombre"
                    placeholder="Ingrese el nombre del canjeable"
                    [class.is-invalid]="nombre?.invalid && nombre?.touched"
                    [class.is-valid]="nombre?.valid && nombre?.touched">
                @if (nombre?.invalid && nombre?.touched) {
                <div class="invalid-feedback">
                    @if (nombre?.errors?.['required']) {
                    <span>El nombre es obligatorio</span>
                    }
                    @if (nombre?.errors?.['maxlength']) {
                    <span>El nombre no puede exceder 255 caracteres</span>
                    }
                </div>
                }
            </div>

            <!-- Sponsor -->
            <div class="form-group">
                <label for="sponsorId">
                    Sponsor <span class="required-asterisk">*</span>
                </label>
                <select id="sponsorId" class="form-control" formControlName="sponsorId"
                    [class.is-invalid]="sponsorId?.invalid && sponsorId?.touched"
                    [class.is-valid]="sponsorId?.valid && sponsorId?.touched">
                    <option [ngValue]="null" disabled>Seleccione un sponsor</option>
                    @for (sponsor of sponsors; track sponsor.id) {
                    <option [ngValue]="sponsor.id">{{ sponsor.nombre }}</option>
                    }
                </select>
                @if (sponsorId?.invalid && sponsorId?.touched) {
                <div class="invalid-feedback">
                    <span>Debe seleccionar un sponsor</span>
                </div>
                }
            </div>

            <!-- URL -->
            <div class="form-group">
                <label for="url">URL del Canjeable</label>
                <input type="url" id="url" class="form-control" formControlName="url"
                    placeholder="https://ejemplo.com/oferta">
            </div>

            <!-- Costo en Puntos -->
            <div class="form-group">
                <label for="costoPuntos">
                    Costo en Puntos <span class="required-asterisk">*</span>
                </label>
                <input type="number" id="costoPuntos" class="form-control" formControlName="costoPuntos"
                    placeholder="100" min="1" [class.is-invalid]="costoPuntos?.invalid && costoPuntos?.touched"
                    [class.is-valid]="costoPuntos?.valid && costoPuntos?.touched">
                @if (costoPuntos?.invalid && costoPuntos?.touched) {
                <div class="invalid-feedback">
                    @if (costoPuntos?.errors?.['required']) {
                    <span>El costo en puntos es obligatorio</span>
                    }
                    @if (costoPuntos?.errors?.['min']) {
                    <span>El costo debe ser al menos 1 punto</span>
                    }
                </div>
                }
            </div>

            <!-- Válido Hasta -->
            <div class="form-group">
                <label for="validoHasta">
                    Válido Hasta <span class="required-asterisk">*</span>
                </label>
                <input type="date" id="validoHasta" class="form-control" formControlName="validoHasta"
                    [class.is-invalid]="validoHasta?.invalid && validoHasta?.touched"
                    [class.is-valid]="validoHasta?.valid && validoHasta?.touched">
                @if (validoHasta?.invalid && validoHasta?.touched) {
                <div class="invalid-feedback">
                    <span>La fecha de vencimiento es obligatoria</span>
                </div>
                }
            </div>

            <!-- Estado activo -->
            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" formControlName="activo" class="checkbox-input">
                    <span class="checkbox-text">Canjeable activo</span>
                </label>
            </div>

            <!-- Botones de acción -->
            @if (!isViewMode) {
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="volver()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="canjeableForm.invalid">
                    {{ canjeableId ? 'Guardar Cambios' : 'Crear Canjeable' }}
                </button>
            </div>
            }
        </form>
        }
    </div>
</div>