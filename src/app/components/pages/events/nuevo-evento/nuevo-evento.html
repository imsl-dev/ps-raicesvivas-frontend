<div class="evento-form-container">
    <div class="form-content">
        <h2>{{ tituloFormulario }}</h2>

        <form [formGroup]="eventoForm" (ngSubmit)="onSubmit()">

            <!-- Secci√≥n: Informaci√≥n B√°sica -->
            <div class="section-divider">üìã Informaci√≥n B√°sica</div>

            <!-- Primera fila: Nombre y Tipo -->
            <div class="row">
                <div class="col-md-8">
                    <div class="form-group">
                        <label for="nombre">
                            Nombre del Evento <span class="required-asterisk">*</span>
                        </label>
                        <input type="text" id="nombre" formControlName="nombre" class="form-control" [ngClass]="{
                'is-invalid': nombre?.invalid && nombre?.touched,
                'is-valid': nombre?.valid && nombre?.touched
              }" placeholder="Ej: Reforestaci√≥n Sierra Grande">
                        @if (nombre?.invalid && nombre?.touched) {
                        <div class="error-message">
                            @if (nombre?.errors?.['required']) {
                            <small>‚ö†Ô∏è El nombre es obligatorio</small>
                            }
                            @if (nombre?.errors?.['maxlength']) {
                            <small>‚ö†Ô∏è El nombre no puede exceder 255 caracteres</small>
                            }
                        </div>
                        }
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-group">
                        <label for="tipo">
                            Tipo de Evento <span class="required-asterisk">*</span>
                        </label>
                        <select id="tipo" formControlName="tipo" class="form-control" [ngClass]="{
                'is-invalid': tipo?.invalid && tipo?.touched,
                'is-valid': tipo?.valid && tipo?.touched
              }">
                            <option value="">Seleccione un tipo</option>
                            @for (tipoEvento of tiposEvento; track tipoEvento) {
                            <option [value]="tipoEvento">{{ tipoEvento }}</option>
                            }
                        </select>
                        @if (tipo?.invalid && tipo?.touched) {
                        <div class="error-message">
                            <small>‚ö†Ô∏è Seleccione un tipo de evento</small>
                        </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Descripci√≥n -->
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="descripcion">Descripci√≥n del Evento</label>
                        <textarea id="descripcion" formControlName="descripcion" class="form-control" rows="4"
                            placeholder="Describa los detalles y objetivos del evento..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n: Ubicaci√≥n y Organizaci√≥n -->
            <div class="section-divider">üìç Ubicaci√≥n y Organizaci√≥n</div>

            <!-- Tercera fila: Provincia y Sponsor (Estado solo en edici√≥n) -->
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="provinciaId">
                            Provincia <span class="required-asterisk">*</span>
                        </label>
                        <select id="provinciaId" formControlName="provinciaId" class="form-control" [ngClass]="{
                'is-invalid': provinciaId?.invalid && provinciaId?.touched,
                'is-valid': provinciaId?.valid && provinciaId?.touched
              }">
                            <option value="">Seleccione provincia</option>
                            @for (provincia of provincias; track provincia.id) {
                            <option [value]="provincia.id">{{ provincia.nombre }}</option>
                            }
                        </select>
                        @if (provinciaId?.invalid && provinciaId?.touched) {
                        <div class="error-message">
                            <small>‚ö†Ô∏è Seleccione una provincia</small>
                        </div>
                        }
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="sponsorId">Sponsor (Opcional)</label>
                        <select id="sponsorId" formControlName="sponsorId" class="form-control">
                            <option value="">Sin sponsor</option>
                            @for (sponsor of sponsors; track sponsor.id) {
                            <option [value]="sponsor.id">{{ sponsor.nombre }}</option>
                            }
                        </select>
                    </div>
                </div>
            </div>

            <!-- Estado - Solo en modo edici√≥n -->
            @if (mostrarCampoEstado) {
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="estado">
                            Estado <span class="required-asterisk">*</span>
                        </label>
                        <select id="estado" formControlName="estado" class="form-control">
                            @for (estadoEvento of estadosEventoEdicion; track estadoEvento) {
                            <option [value]="estadoEvento">{{ estadoEvento }}</option>
                            }
                        </select>
                        <small class="text-muted">
                            ‚ÑπÔ∏è Solo puede cambiar el estado a CANCELADO. Los estados EN CURSO y FINALIZADO se actualizan
                            autom√°ticamente.
                        </small>
                    </div>
                </div>
            </div>
            }

            <!-- Direcci√≥n -->
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="direccion">Direcci√≥n del Evento</label>
                        <input type="text" id="direccion" formControlName="direccion" class="form-control" [ngClass]="{
                'is-invalid': direccion?.invalid && direccion?.touched,
                'is-valid': direccion?.valid && direccion?.touched
              }" placeholder="Ej: Av. Principal 1234, Ciudad">
                        @if (direccion?.invalid && direccion?.touched) {
                        <div class="error-message">
                            @if (direccion?.errors?.['maxlength']) {
                            <small>‚ö†Ô∏è La direcci√≥n no puede exceder 500 caracteres</small>
                            }
                        </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Secci√≥n: Fechas y Horarios -->
            <div class="section-divider">üìÖ Fechas y Horarios</div>

            <!-- Quinta fila: Fechas -->
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="horaInicio">
                            Fecha y Hora de Inicio <span class="required-asterisk">*</span>
                        </label>
                        <input type="datetime-local" id="horaInicio" formControlName="horaInicio" class="form-control"
                            [ngClass]="{
                'is-invalid': (horaInicio?.invalid && horaInicio?.touched) || fechaInicioInvalida,
                'is-valid': horaInicio?.valid && horaInicio?.touched && !fechaInicioInvalida
              }">
                        @if (horaInicio?.invalid && horaInicio?.touched) {
                        <div class="error-message">
                            <small>‚ö†Ô∏è La fecha de inicio es obligatoria</small>
                        </div>
                        }
                        @if (fechaInicioInvalida) {
                        <div class="error-message">
                            <small>‚ö†Ô∏è La fecha de inicio debe ser posterior a la fecha actual</small>
                        </div>
                        }
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="horaFin">
                            Fecha y Hora de Fin <span class="required-asterisk">*</span>
                        </label>
                        <input type="datetime-local" id="horaFin" formControlName="horaFin" class="form-control"
                            [ngClass]="{
                'is-invalid': (horaFin?.invalid && horaFin?.touched) || fechaFinInvalida || diferenciaHorasInvalida,
                'is-valid': horaFin?.valid && horaFin?.touched && !fechaFinInvalida && !diferenciaHorasInvalida
              }">
                        @if (horaFin?.invalid && horaFin?.touched) {
                        <div class="error-message">
                            <small>‚ö†Ô∏è La fecha de fin es obligatoria</small>
                        </div>
                        }
                        @if (fechaFinInvalida) {
                        <div class="error-message">
                            <small>‚ö†Ô∏è La fecha de fin debe ser posterior a la fecha de inicio</small>
                        </div>
                        }
                        @if (diferenciaHorasInvalida) {
                        <div class="error-message">
                            <small>‚ö†Ô∏è Debe haber al menos 1 hora de diferencia entre el inicio y el fin del
                                evento</small>
                        </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Secci√≥n: Puntos y Costos -->
            <div class="section-divider">üí∞ Puntos y Costos</div>

            <!-- Sexta fila: Puntos y Costos -->
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="puntosAsistencia">Puntos por Asistencia</label>
                        <input type="number" id="puntosAsistencia" formControlName="puntosAsistencia"
                            class="form-control" min="0" placeholder="0">
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-group">
                        <label for="costoInterno">Costo Interno ($)</label>
                        <input type="number" id="costoInterno" formControlName="costoInterno" class="form-control"
                            min="0" step="0.01" placeholder="0.00">
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-group">
                        <label for="costoInscripcion">Costo de Inscripci√≥n ($)</label>
                        <input type="number" id="costoInscripcion" formControlName="costoInscripcion"
                            class="form-control" min="0" step="0.01" placeholder="0.00">
                    </div>
                </div>
            </div>

            <!-- Secci√≥n: Imagen -->
            <div class="section-divider">üñºÔ∏è Imagen del Evento</div>

            <!-- Imagen del Evento -->
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="rutaImg">Imagen del Evento (Opcional)</label>
                        <div class="image-upload-container">
                            <input type="file" id="rutaImg" accept="image/*" (change)="onFileSelected($event)"
                                class="file-input">
                            <label for="rutaImg" class="file-label">
                                @if (!imagenPreview) {
                                <span>üìÅ Seleccionar imagen</span>
                                }
                                @if (imagenPreview) {
                                <span>üîÑ Cambiar imagen</span>
                                }
                            </label>
                        </div>

                        @if (imagenPreview) {
                        <div class="image-preview">
                            <img [src]="imagenPreview" alt="Vista previa del evento">
                            <button type="button" class="btn-remove" (click)="removeImage()">
                                ‚úï Eliminar imagen
                            </button>
                        </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary" [disabled]="eventoForm.invalid">
                    üíæ Guardar Evento
                </button>
                <button type="button" class="btn btn-secondary" (click)="resetForm()">
                    üîÑ Limpiar
                </button>
                <button type="button" class="btn btn-tertiary" (click)="volver()">
                    ‚Üê Volver
                </button>
            </div>
        </form>
    </div>
</div>