<div class="detalle-evento-container">
  <!-- Estado de carga -->
  @if (loading) {
  <div class="loading-container">
    <div class="spinner-border text-success mb-3" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p>Cargando detalles del evento...</p>
  </div>
  }

  <!-- Mensaje de error -->
  @if (error && !loading) {
  <div class="error-container">
    <div class="error-content">
      <p class="error-message">{{ error }}</p>
      <button class="btn btn-secondary" (click)="volver()">
        â† Volver a Eventos
      </button>
    </div>
  </div>
  }

  <!-- Detalle del evento -->
  @if (evento && !loading && !error) {
  <div class="evento-detalle">
    <!-- Header con imagen -->
    <div class="evento-header">
      @if (evento.rutaImg) {
      <img [src]="evento.rutaImg" [alt]="evento.nombre" class="evento-imagen-principal">
      } @else {
      <div class="evento-imagen-placeholder">
        <span class="placeholder-icon">ğŸŒ±</span>
      </div>
      }
      <div class="header-overlay">
        <div class="header-badges">
          <span class="tipo-badge">{{ evento.tipo | tipoEvento }}</span>
          <span class="estado-badge" [ngClass]="getEstadoClass(evento.estado)">
            {{ evento.estado }}
          </span>
        </div>
      </div>
    </div>

    <!-- Contenido principal -->
    <div class="evento-content">
      <!-- TÃ­tulo y acciones -->
      <div class="titulo-section">
        <h1 class="evento-titulo">{{ evento.nombre }}</h1>
        <div class="acciones-rapidas">
          <button class="btn-icon" (click)="realizarDonacion()" title="Realizar donaciÃ³n">
            â¤ï¸
          </button>
          <button class="btn-icon" (click)="compartirEvento()" title="Compartir evento">
            ğŸ“¤
          </button>
        </div>
      </div>

      <!-- InformaciÃ³n destacada -->
      <div class="info-destacada">
        <!-- Fecha y hora -->
        <div class="info-card">
          <div class="info-header">
            <span class="info-icon">ğŸ“…</span>
            <h3>Fecha y Hora</h3>
          </div>
          <div class="info-body">
            <p class="info-principal">{{ formatDate(evento.horaInicio) }}</p>
            <div class="info-horario">
              <div class="horario-item">
                <span class="horario-label">â° Inicio:</span>
                <span class="horario-valor">{{ formatTime(evento.horaInicio) }}</span>
              </div>
              <div class="horario-item">
                <span class="horario-label">â±ï¸ Fin:</span>
                <span class="horario-valor">{{ formatTime(evento.horaFin) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- UbicaciÃ³n -->
        <div class="info-card">
          <div class="info-header">
            <span class="info-icon">ğŸ“</span>
            <h3>UbicaciÃ³n</h3>
          </div>
          <div class="info-body">
            <p class="info-principal">{{ evento.provincia?.nombre }}</p>
            @if (evento.direccion) {
            <p class="info-secundaria">{{ evento.direccion }}</p>
            }
          </div>
        </div>

        <!-- Organizador -->
        @if (evento.sponsor) {
        <div class="info-card">
          <div class="info-header">
            <span class="info-icon">ğŸ¤</span>
            <h3>Organiza</h3>
          </div>
          <div class="info-body">
            <p class="info-principal">{{ evento.sponsor.nombre }}</p>
          </div>
        </div>
        }
      </div>

      <!-- DescripciÃ³n -->
      @if (evento.descripcion) {
      <div class="descripcion-section">
        <h2 class="section-title">ğŸ“‹ DescripciÃ³n</h2>
        <div class="descripcion-content">
          <p>{{ evento.descripcion }}</p>
        </div>
      </div>
      }

      <!-- InformaciÃ³n adicional -->
      <div class="info-adicional">
        <h2 class="section-title">â„¹ï¸ InformaciÃ³n Adicional</h2>
        <div class="info-grid">
          @if (evento.puntosAsistencia) {
          <div class="info-item">
            <span class="item-icon">â­</span>
            <div class="item-content">
              <span class="item-label">Puntos por Asistencia</span>
              <span class="item-valor">{{ evento.puntosAsistencia }} puntos</span>
            </div>
          </div>
          }

          @if (evento.costoInscripcion !== undefined && evento.costoInscripcion !== null) {
          <div class="info-item">
            <span class="item-icon">ğŸ’°</span>
            <div class="item-content">
              <span class="item-label">Costo de InscripciÃ³n</span>
              <span class="item-valor">
                @if (evento.costoInscripcion === 0) {
                Gratis
                } @else {
                ${{ evento.costoInscripcion }}
                }
              </span>
            </div>
          </div>
          }

          <div class="info-item">
            <span class="item-icon">ğŸ‘¥</span>
            <div class="item-content">
              <span class="item-label">Modalidad</span>
              <span class="item-valor">Presencial</span>
            </div>
          </div>

          <div class="info-item">
            <span class="item-icon">ğŸ«</span>
            <div class="item-content">
              <span class="item-label">Entrada</span>
              <span class="item-valor">
                @if (evento.costoInscripcion === 0 || !evento.costoInscripcion) {
                Libre y Gratuita
                } @else {
                Requiere InscripciÃ³n
                }
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Botones de acciÃ³n -->
      <div class="acciones-principales">
        @if (evento.estado === 'PRÃ“XIMO' && usuarioLogeado?.rol === 'USUARIO') {
        @if (!estaInscripto) {
        @if (tieneCostoInscripcion()) {
        <button class="btn btn-success btn-lg" (click)="abrirModalConfirmacionPago()" [disabled]="procesandoPago">
          @if (procesandoPago) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Procesando pago...
          } @else {
          ğŸ’³ Pagar InscripciÃ³n (${{ evento.costoInscripcion }})
          }
        </button>
        <p class="texto-pago-info">
          ğŸ”’ SerÃ¡s redirigido a MercadoPago para completar el pago de forma segura
        </p>
        } @else {
        <button class="btn btn-success btn-lg" (click)="inscribirseEvento()" [disabled]="procesandoInscripcion">
          @if (procesandoInscripcion) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Procesando...
          } @else {
          âœ… Inscribirme al Evento (Gratis)
          }
        </button>
        }
        } @else {
        <div class="inscripcion-confirmada">
          <div class="mensaje-inscripto">
            <span class="icono-check">âœ“</span>
            <span>Ya estÃ¡s inscripto a este evento</span>
          </div>
          @if(!tieneCostoInscripcion){
          <button class="btn btn-warning" (click)="abrirModalCancelacion()" [disabled]="procesandoInscripcion">
            ğŸš« Cancelar InscripciÃ³n
          </button>
          }
        </div>
        }
        }

        @if (evento.estado === 'CANCELADO') {
        <div class="alerta-cancelado">
          <p>âš ï¸ Este evento ha sido cancelado</p>
        </div>
        }

        @if (usuarioLogeado?.rol === 'ORGANIZADOR' && evento.organizadorId === usuarioLogeado?.id && evento.estado ===
        'PRÃ“XIMO') {
        <button class="btn btn-secondary" (click)="editarEvento()">
          âœï¸ Editar Evento
        </button>
        }

        <button class="btn btn-outline" (click)="volver()">
          â† Volver a Eventos
        </button>
      </div>

      <!-- InformaciÃ³n de contacto o advertencias -->
      <div class="info-footer">
        <p class="texto-pequeÃ±o">
          ğŸ’¡ <strong>Recordatorio:</strong> Por favor, llega 15 minutos antes del inicio del evento.
        </p>
      </div>
    </div>
  </div>
  }
  <!-- Modal de confirmaciÃ³n de cancelaciÃ³n -->
  @if (mostrarModalCancelacion) {
  <div class="modal-overlay" (click)="cerrarModalCancelacion()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>âš ï¸ Confirmar CancelaciÃ³n</h3>
        <button class="btn-close-modal" (click)="cerrarModalCancelacion()">âœ•</button>
      </div>

      <div class="modal-body">
        <p>Â¿EstÃ¡s seguro de que deseas cancelar tu inscripciÃ³n a este evento?</p>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary-modal" (click)="cerrarModalCancelacion()" [disabled]="procesandoInscripcion">
          Volver
        </button>
        <button class="btn btn-danger-modal" (click)="confirmarCancelacion()" [disabled]="procesandoInscripcion">
          @if (procesandoInscripcion) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Cancelando...
          } @else {
          Confirmar CancelaciÃ³n
          }
        </button>
      </div>
    </div>
  </div>
  }
  <!-- Modal de confirmaciÃ³n de pago -->
  @if (mostrarModalConfirmacionPago) {
  <div class="modal-overlay" (click)="cerrarModalConfirmacionPago()">
    <div class="modal-content modal-pago" (click)="$event.stopPropagation()">
      <div class="modal-header modal-header-pago">
        <h3>ğŸ’³ Confirmar Compra</h3>
        <button class="btn-close-modal" (click)="cerrarModalConfirmacionPago()">âœ•</button>
      </div>

      <div class="modal-body">
        <div class="info-pago-destacada">
          <div class="monto-total">
            <span class="label-monto">Total a pagar:</span>
            <span class="valor-monto">${{ evento?.costoInscripcion }}</span>
          </div>
        </div>

        <div class="advertencia-reembolso advertencia-pago">
          <span class="icono-advertencia">ğŸ’°</span>
          <div class="texto-advertencia">
            <strong>Importante:</strong>
            <p>Este evento tiene un costo de inscripciÃ³n de <strong>${{ evento?.costoInscripcion }}</strong>.
              No se realizarÃ¡ reembolso por la cancelaciÃ³n del evento o la inasistencia al mismo.</p>
          </div>
        </div>

        <div class="info-mercadopago">
          <span class="icono-info">ğŸ”’</span>
          <p>SerÃ¡s redirigido a MercadoPago para completar el pago de forma segura</p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary-modal" (click)="cerrarModalConfirmacionPago()" [disabled]="procesandoPago">
          Cancelar
        </button>
        <button class="btn btn-success-modal" (click)="confirmarYProcesarPago()" [disabled]="procesandoPago">
          @if (procesandoPago) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Procesando...
          } @else {
          Confirmar Compra
          }
        </button>
      </div>
    </div>
  </div>
  }
  <!-- Modal de donaciÃ³n -->
  @if (mostrarModalDonacion) {
  <div class="modal-overlay" (click)="confirmarCierreDonacion()">
    <div class="modal-content modal-donacion" (click)="$event.stopPropagation()">
      <div class="modal-header modal-header-donacion">
        <h3>â¤ï¸ Realizar DonaciÃ³n</h3>
        <button class="btn-close-modal" (click)="confirmarCierreDonacion()">âœ•</button>
      </div>

      <div class="modal-body">
        <div class="form-group-donacion">
          <label for="mensaje-donacion" class="label-donacion">TransmitÃ­ tu mensaje al mundo</label>
          <textarea id="mensaje-donacion" class="textarea-donacion" [(ngModel)]="mensajeDonacion"
            placeholder="Escribe un mensaje motivacional (opcional)" rows="4" maxlength="500"
            [disabled]="procesandoDonacion"></textarea>
          <small class="char-count">{{ mensajeDonacion.length }}/500 caracteres</small>
        </div>

        <div class="form-group-donacion">
          <label for="monto-donacion" class="label-donacion">Monto:</label>
          <div class="input-monto-wrapper">
            <span class="currency-symbol">$</span>
            <input type="number" id="monto-donacion" class="input-monto" [(ngModel)]="montoDonacion"
              placeholder="IngresÃ¡ el monto" min="1" step="1" [disabled]="procesandoDonacion">
          </div>
          <small class="helper-text">Monto mÃ­nimo: $100</small>
        </div>

        <div class="info-donacion">
          <span class="icono-info">ğŸ’š</span>
          <p>Tu donaciÃ³n ayudarÃ¡ a seguir plantando Ã¡rboles y cuidando nuestro planeta. Â¡Gracias por tu generosidad!</p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary-modal" (click)="confirmarCierreDonacion()" [disabled]="procesandoDonacion">
          Cancelar
        </button>
        <button class="btn btn-success-modal" (click)="procesarDonacion()"
          [disabled]="!validarMontoDonacion() || procesandoDonacion">
          @if (procesandoDonacion) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Procesando...
          } @else {
          Donar! ğŸŒ±
          }
        </button>
      </div>
    </div>
  </div>
  }

  <!-- Modal de confirmaciÃ³n para cancelar donaciÃ³n -->
@if (mostrarModalCancelarDonacion) {
<div class="modal-overlay" (click)="$event.stopPropagation()">
  <div class="modal-content modal-cancelar-donacion" (click)="$event.stopPropagation()">
    <div class="modal-header modal-header-cancelar">
      <h3>ğŸ˜¢ Â¿Cancelar DonaciÃ³n?</h3>
      <button class="btn-close-modal" (click)="cerrarModalCancelarDonacion()">âœ•</button>
    </div>

    <div class="modal-body">
      <p>Â¿EstÃ¡s seguro de que deseas cancelar tu donaciÃ³n?</p>
      <div class="mensaje-emotivo">
        <span class="icono-triste">ğŸ’š</span>
        <p>Cada aporte cuenta para seguir plantando Ã¡rboles y cuidando nuestro planeta. Tu generosidad puede hacer la diferencia.</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-success-modal" (click)="cerrarModalCancelarDonacion()">
        ğŸ’š Continuar con mi DonaciÃ³n
      </button>
      <button class="btn btn-secondary-modal" (click)="confirmarCancelacionDonacion()">
        Cancelar DonaciÃ³n
      </button>
    </div>
  </div>
</div>
}
</div>