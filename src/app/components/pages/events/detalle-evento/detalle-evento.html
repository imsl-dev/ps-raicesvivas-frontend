<div class="detalle-evento-container">
  <!-- Estado de carga -->
  @if (loading) {
  <div class="loading-container">
    <div class="spinner-border text-success mb-3" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p>Cargando detalles del evento...</p>
  </div>
  }

  <!-- Mensaje de error -->
  @if (error && !loading) {
  <div class="error-container">
    <div class="error-content">
      <p class="error-message">{{ error }}</p>
      <button class="btn btn-secondary" (click)="volver()">
        ‚Üê Volver a Eventos
      </button>
    </div>
  </div>
  }

  <!-- Detalle del evento -->
  @if (evento && !loading && !error) {
  <div class="evento-detalle">
    <!-- Header con imagen -->
    <div class="evento-header">
      @if (evento.rutaImg) {
      <img [src]="evento.rutaImg" [alt]="evento.nombre" class="evento-imagen-principal">
      } @else {
      <div class="evento-imagen-placeholder">
        <span class="placeholder-icon">üå±</span>
      </div>
      }
      <div class="header-overlay">
        <div class="header-badges">
          <span class="tipo-badge">{{ evento.tipo | tipoEvento }}</span>
          <span class="estado-badge" [ngClass]="getEstadoClass(evento.estado)">
            {{ evento.estado }}
          </span>
        </div>
      </div>
    </div>

    <!-- Contenido principal -->
    <div class="evento-content">
      <!-- T√≠tulo y acciones -->
      <div class="titulo-section">
        <h1 class="evento-titulo">{{ evento.nombre }}</h1>
        <div class="acciones-rapidas">
          <button class="btn-icon" (click)="marcarFavorito()" title="Agregar a favoritos">
            ‚ù§Ô∏è
          </button>
          <button class="btn-icon" (click)="compartirEvento()" title="Compartir evento">
            üì§
          </button>
        </div>
      </div>

      <!-- Informaci√≥n destacada -->
      <div class="info-destacada">
        <!-- Fecha y hora -->
        <div class="info-card">
          <div class="info-header">
            <span class="info-icon">üìÖ</span>
            <h3>Fecha y Hora</h3>
          </div>
          <div class="info-body">
            <p class="info-principal">{{ formatDate(evento.horaInicio) }}</p>
            <div class="info-horario">
              <div class="horario-item">
                <span class="horario-label">‚è∞ Inicio:</span>
                <span class="horario-valor">{{ formatTime(evento.horaInicio) }}</span>
              </div>
              <div class="horario-item">
                <span class="horario-label">‚è±Ô∏è Fin:</span>
                <span class="horario-valor">{{ formatTime(evento.horaFin) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Ubicaci√≥n -->
        <div class="info-card">
          <div class="info-header">
            <span class="info-icon">üìç</span>
            <h3>Ubicaci√≥n</h3>
          </div>
          <div class="info-body">
            <p class="info-principal">{{ evento.provincia?.nombre }}</p>
            @if (evento.direccion) {
            <p class="info-secundaria">{{ evento.direccion }}</p>
            }
          </div>
        </div>

        <!-- Organizador -->
        @if (evento.sponsor) {
        <div class="info-card">
          <div class="info-header">
            <span class="info-icon">ü§ù</span>
            <h3>Organiza</h3>
          </div>
          <div class="info-body">
            <p class="info-principal">{{ evento.sponsor.nombre }}</p>
          </div>
        </div>
        }
      </div>

      <!-- Descripci√≥n -->
      @if (evento.descripcion) {
      <div class="descripcion-section">
        <h2 class="section-title">üìã Descripci√≥n</h2>
        <div class="descripcion-content">
          <p>{{ evento.descripcion }}</p>
        </div>
      </div>
      }

      <!-- Informaci√≥n adicional -->
      <div class="info-adicional">
        <h2 class="section-title">‚ÑπÔ∏è Informaci√≥n Adicional</h2>
        <div class="info-grid">
          @if (evento.puntosAsistencia) {
          <div class="info-item">
            <span class="item-icon">‚≠ê</span>
            <div class="item-content">
              <span class="item-label">Puntos por Asistencia</span>
              <span class="item-valor">{{ evento.puntosAsistencia }} puntos</span>
            </div>
          </div>
          }

          @if (evento.costoInscripcion !== undefined && evento.costoInscripcion !== null) {
          <div class="info-item">
            <span class="item-icon">üí∞</span>
            <div class="item-content">
              <span class="item-label">Costo de Inscripci√≥n</span>
              <span class="item-valor">
                @if (evento.costoInscripcion === 0) {
                Gratis
                } @else {
                ${{ evento.costoInscripcion }}
                }
              </span>
            </div>
          </div>
          }

          <div class="info-item">
            <span class="item-icon">üë•</span>
            <div class="item-content">
              <span class="item-label">Modalidad</span>
              <span class="item-valor">Presencial</span>
            </div>
          </div>

          <div class="info-item">
            <span class="item-icon">üé´</span>
            <div class="item-content">
              <span class="item-label">Entrada</span>
              <span class="item-valor">
                @if (evento.costoInscripcion === 0 || !evento.costoInscripcion) {
                Libre y Gratuita
                } @else {
                Requiere Inscripci√≥n
                }
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Botones de acci√≥n -->
      <div class="acciones-principales">
        @if (evento.estado === 'PR√ìXIMO' && usuarioLogeado?.rol === 'USUARIO') {
        @if (!estaInscripto) {
        @if (tieneCostoInscripcion()) {
        @if (!yaPago) {
        <button class="btn btn-success btn-lg" (click)="inscribirseEvento()" [disabled]="procesandoPago">
          @if (procesandoPago) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Procesando pago...
          } @else {
          üí≥ Pagar Inscripci√≥n (${{ evento?.costoInscripcion }})
          }
        </button>
        <p class="texto-pago-info">
          üîí Ser√°s redirigido a MercadoPago para completar el pago de forma segura
        </p>
        } @else {
        <button class="btn btn-success btn-lg" (click)="inscribirseEvento()" [disabled]="procesandoInscripcion">
          @if (procesandoInscripcion) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Procesando...
          } @else {
          ‚úÖ Completar Inscripci√≥n (Ya Pagaste)
          }
        </button>
        <p class="texto-pago-info texto-success">
          ‚úì Tu pago fue aprobado correctamente
        </p>
        }
        } @else {
        <button class="btn btn-success btn-lg" (click)="inscribirseEvento()" [disabled]="procesandoInscripcion">
          @if (procesandoInscripcion) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Procesando...
          } @else {
          ‚úÖ Inscribirme al Evento (Gratis)
          }
        </button>
        }
        } @else {
        <div class="inscripcion-confirmada">
          <div class="mensaje-inscripto">
            <span class="icono-check">‚úì</span>
            <span>Ya est√°s inscripto a este evento</span>
          </div>
          <button class="btn btn-warning" (click)="abrirModalCancelacion()" [disabled]="procesandoInscripcion">
            üö´ Cancelar Inscripci√≥n
          </button>
        </div>
        }
        }

        @if (evento.estado === 'CANCELADO') {
        <div class="alerta-cancelado">
          <p>‚ö†Ô∏è Este evento ha sido cancelado</p>
        </div>
        }

        @if (usuarioLogeado?.rol === 'ORGANIZADOR' && evento.organizadorId === usuarioLogeado?.id && evento.estado === 'PR√ìXIMO') {
        <button class="btn btn-secondary" (click)="editarEvento()">
          ‚úèÔ∏è Editar Evento
        </button>
        }

        <button class="btn btn-outline" (click)="volver()">
          ‚Üê Volver a Eventos
        </button>
      </div>

      <!-- Informaci√≥n de contacto o advertencias -->
      <div class="info-footer">
        <p class="texto-peque√±o">
          üí° <strong>Recordatorio:</strong> Por favor, llega 15 minutos antes del inicio del evento.
        </p>
      </div>
    </div>
  </div>
  }
  <!-- Modal de confirmaci√≥n de cancelaci√≥n -->
  @if (mostrarModalCancelacion) {
  <div class="modal-overlay" (click)="cerrarModalCancelacion()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>‚ö†Ô∏è Confirmar Cancelaci√≥n</h3>
        <button class="btn-close-modal" (click)="cerrarModalCancelacion()">‚úï</button>
      </div>

      <div class="modal-body">
        <p>¬øEst√°s seguro de que deseas cancelar tu inscripci√≥n a este evento?</p>

        @if (tieneCostoInscripcion()) {
        <div class="advertencia-reembolso">
          <span class="icono-advertencia">üí∞</span>
          <div class="texto-advertencia">
            <strong>Importante:</strong>
            <p>Este evento tiene un costo de inscripci√≥n de <strong>${{ evento?.costoInscripcion }}</strong>.
              No se realizar√° reembolso por la cancelaci√≥n de la inscripci√≥n.</p>
          </div>
        </div>
        }
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary-modal" (click)="cerrarModalCancelacion()" [disabled]="procesandoInscripcion">
          Volver
        </button>
        <button class="btn btn-danger-modal" (click)="confirmarCancelacion()" [disabled]="procesandoInscripcion">
          @if (procesandoInscripcion) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Cancelando...
          } @else {
          Confirmar Cancelaci√≥n
          }
        </button>
      </div>
    </div>
  </div>
  }
</div>